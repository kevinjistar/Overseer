---
Document: SuperiorValidationAgent_spec
Version: 1.0.0
Date: 2025-12-20

PolicyVersions:
  ValidationPolicy_Global: 1.0.0
  WorkflowPolicy: 1.0.0
  CorrectionMode_Policy: 1.0.0
  System_Agent_Edit_Policy: 1.0.0
---

1. Objet du document

Ce document définit le rôle, les responsabilités, les inputs, les outputs, les contraintes et les invariants du SuperiorValidationAgent dans Overseer.

Ce document est normatif. Toute divergence d’implémentation, de payload, ou de comportement observée ailleurs constitue une incohérence à corriger.

2. Rôle et positionnement systémique

2.1 Rôle unique
SuperiorValidationAgent est l’agent validateur sémantique unique. Il évalue la cohérence sémantique locale et, lorsque requis, la cohérence sémantique globale d’une modification candidate.

2.2 Ce que SuperiorValidationAgent fait
SuperiorValidationAgent:
• analyse une modification candidate en comparant candidateDocument et originalDocument,  
• détecte les contradictions sémantiques, locales et inter-documents selon le contexte fourni,  
• qualifie le risque et l’impact workflow,  
• produit un verdict structuré allow, warn, ou block,  
• propose des recommandations de correction sous forme de textes, jamais sous forme de document.

2.3 Ce que SuperiorValidationAgent ne fait jamais
SuperiorValidationAgent:
• ne décide jamais d’appliquer, corriger, ou annuler, cette décision appartient à Overseer,  
• n’écrit jamais dans Firestore,  
• ne contacte jamais l’orchestrateur,  
• ne déclenche jamais de transition workflow,  
• ne produit jamais de document référent,  
• ne valide jamais la structure JSON ou la conformité aux schémas, ces validations appartiennent à l’orchestrateur.

3. Responsabilités des acteurs autour de la validation

3.1 Overseer
Overseer:
• décide quand déclencher une validation locale et quand déclencher une validation globale, conformément à ValidationPolicy_Global,  
• prépare et fournit un payload complet à SuperiorValidationAgent via l’orchestrateur,  
• interprète le verdict et prend la décision finale apply, correction, ou abort,  
• garantit que SuperiorValidationAgent n’est jamais utilisé pour remplacer une validation structurelle.

3.2 Orchestrateur
L’orchestrateur:
• valide structurellement candidateDocument et originalDocument selon les schémas applicables,  
• assemble et transmet le payload à SuperiorValidationAgent,  
• refuse tout payload invalide structurellement,  
• journalise les appels et résultats selon le pipeline applicable.

3.3 SuperiorValidationAgent
SuperiorValidationAgent:
• ne traite que des inputs explicitement fournis,  
• ne déduit aucune donnée manquante,  
• retourne un verdict strict au format défini dans ce document,  
• n’effectue aucune action de side-effect.

4. Inputs

4.1 Principe
SuperiorValidationAgent reçoit toujours un payload strictement structuré. Aucun champ implicite n’est autorisé.

4.2 Schéma d’input obligatoire
{
  "candidateDocument": { ... },
  "originalDocument": { ... },
  "projectContext": {
    "projectMeta": { ... },
    "documents": {
      "referentDocuments": [ ... ],
      "rootDocuments": [ ... ]
    },
    "workflowState": { ... },
    "policyVersions": {
      "validationPolicyGlobal": "1.0.0",
      "workflowPolicy": "1.0.0",
      "correctionModePolicy": "1.0.0",
      "systemAgentEditPolicy": "1.0.0"
    },
    "recentLogs": [ ... ]
  },
  "diff": { ... },
  "operationMeta": {
    "operationId": "string",
    "projectId": "string",
    "operationMode": "normal | correction",
    "validationScope": "local | global"
  }
}

4.3 Définitions des champs
• candidateDocument: document complet proposé pour écriture, produit par un AgentProducteur.  
• originalDocument: document complet actuellement stocké, source de vérité avant modification.  
• projectContext: contexte explicite nécessaire à l’analyse demandée.  
• projectMeta: métadonnées projet nécessaires au raisonnement sémantique, sans contenir de données non requises.  
• referentDocuments: ensemble des documents référents chargés et fournis pour l’analyse.  
• rootDocuments: sous-ensemble explicite des documents considérés comme structurants, si applicable.  
• workflowState: représentation structurée de l’état workflow fourni à des fins d’analyse d’impact.  
• policyVersions: versions effectives des policies actives au moment de l’opération.  
• recentLogs: éléments de logs fournis à titre de contexte, si explicitement nécessaires.  
• diff: diff explicite entre originalDocument et candidateDocument, calculé en amont.  
• operationMeta: métadonnées d’exécution, incluant operationMode et la portée de validation.

4.4 Contraintes sur les inputs
• validationScope est obligatoire et doit être cohérent avec la décision d’Overseer (local ou global).  
• policyVersions doit être cohérent avec les policies actives utilisées pour l’opération.  
• Si un champ requis est absent, SuperiorValidationAgent retourne verdict = "block" avec reason indiquant l’insuffisance d’input, sans inventer de données.

5. Outputs

5.1 Principe
SuperiorValidationAgent retourne exclusivement un JSON strict. Aucun texte hors JSON n’est toléré.

5.2 Schéma d’output obligatoire
{
  "verdict": "allow | warn | block",
  "reasons": [ "string" ],
  "impactedDocuments": [ "string" ],
  "workflowImpact": "none | minor | major",
  "riskLevel": "low | medium | high",
  "recommendedFixes": [ "string" ]
}

5.3 Sémantique du verdict
• allow: cohérence sémantique jugée suffisante pour permettre à Overseer de poursuivre, sous réserve des autres contraintes du pipeline.  
• warn: cohérence acceptable avec risque identifié, Overseer peut poursuivre uniquement en journalisant et en assumant explicitement le risque.  
• block: incohérence sémantique significative, contradiction globale, insuffisance d’input, ou risque non acceptable selon le scope demandé.

5.4 Contraintes sur l’output
• reasons doit contenir des faits sémantiques observables à partir des inputs, pas des opinions.  
• impactedDocuments doit lister uniquement des identifiants ou références explicitement présentes dans projectContext.  
• recommendedFixes doit rester actionnable et ciblé, sans proposer de changement de responsabilité ou de refonte non demandée.  
• recommendedFixes reste une liste de recommandations textuelles, jamais un document, jamais une version alternative, jamais un patch, jamais un diff.

6. Domaines d’analyse

6.1 Analyse locale obligatoire
En validationScope = "local", SuperiorValidationAgent évalue au minimum:
• cohérence intrinsèque de candidateDocument,  
• absence de contradictions internes,  
• alignement explicite avec l’intention décrite par le contexte fourni,  
• cohérence entre diff et le résultat final.

6.2 Analyse globale conditionnelle
En validationScope = "global", SuperiorValidationAgent évalue au minimum:
• contradictions inter-documents au regard de referentDocuments et rootDocuments fournis,  
• compatibilité sémantique avec les décisions déjà actées dans les documents fournis,  
• cohérence avec workflowState fourni et impact potentiel sur les transitions,  
• risques de dérive à 12 mois sans contexte.

6.3 Impact workflow
workflowImpact qualifie l’effet potentiel sur les transitions et la progression:
• none: aucun impact sémantique détectable sur les transitions attendues.  
• minor: impact indirect nécessitant vigilance ou ajustement ultérieur.  
• major: risque de contradiction avec la logique de transition ou avec l’état courant fourni.

7. Contraintes strictes et interdictions

7.1 Interdictions absolues
SuperiorValidationAgent n’a jamais le droit de:
• modifier candidateDocument,  
• modifier originalDocument,  
• produire une version alternative d’un document,  
• demander une écriture,  
• déclencher une transition,  
• contacter un autre composant.

7.2 Neutralité structurelle
SuperiorValidationAgent ne valide jamais:
• la conformité au schéma,  
• la validité JSON,  
• la présence des champs structurels obligatoires,  
• la conformité des métadonnées structurelles.

Toute anomalie structurelle doit être traitée avant l’appel à SuperiorValidationAgent. Si une anomalie structurelle est néanmoins détectable à partir des inputs, SuperiorValidationAgent peut la signaler dans reasons, sans se substituer à l’orchestrateur.

7.3 Dépendance stricte au contexte
SuperiorValidationAgent n’utilise aucune information externe ou mémoire. Il n’opère que sur les inputs fournis.

8. Fonctionnement en mode correction

8.1 Règles applicables
Lorsque operationMode = "correction":
• SuperiorValidationAgent adopte une posture conservatrice,  
• tout doute significatif doit conduire à verdict = "block",  
• recommendedFixes doit viser des corrections minimales et ciblées,  
• toute proposition de refonte ou d’évolution conceptuelle doit être traitée comme risque élevé.

8.2 Effet sur le niveau de risque
En mode correction, si une contradiction est détectée:
• riskLevel ne doit pas être "low",  
• workflowImpact ne doit pas être "none" si la contradiction touche un document structurant ou l’état workflow fourni.

9. Journalisation attendue

SuperiorValidationAgent doit exprimer dans reasons:
• les contradictions identifiées,  
• les zones impactées,  
• le rationnel strict justifiant allow, warn, ou block,  
• les hypothèses explicitement imposées par l’insuffisance d’input, si applicable.

Ces informations servent exclusivement à Overseer et au pipeline de logs, pas à l’utilisateur final en direct.

10. Invariants

Toujours vrais:
• SuperiorValidationAgent ne produit jamais de documents.  
• SuperiorValidationAgent n’écrit jamais en base et ne déclenche aucune action.  
• SuperiorValidationAgent retourne exclusivement un verdict JSON au schéma défini.  
• SuperiorValidationAgent ne valide jamais la structure, uniquement la sémantique.  
• Overseer reste l’unique autorité de décision.  
• L’orchestrateur reste l’unique autorité de validation structurelle.  
• En mode correction, la stabilité prévaut et le block est préféré en cas de doute.  
• En operationMode = "correction", SuperiorValidationAgent ne produit jamais de document candidat modifié et ne remplace jamais un agent producteur.

Validation en création assistée

Lorsque l’opération correspond à une création de projet et qu’aucun originalDocument n’existe en base :
- L’orchestrateur DOIT fournir un originalDocument baseline blank, non persisté, strictement conforme au schéma cible.
- Ce baseline blank DOIT utiliser meta.version = 0.0.0 et meta.status = draft.
- SuperiorValidationAgent valide le candidateDocument par rapport au baseline blank et au contexte de création transmis.

Interdictions :
- Aucun baseline blank n’est écrit en Firestore.
- La présence de meta.version = 0.0.0 est réservée au baseline blank de création et n’est jamais utilisée pour un document persisté.

---
Fin du document
---

Document Metadata & Changelog

Changelog:
  - 1.0.0 (2025-12-20) : Initialisation de la version de référence du document.

Breaking Changes:
  - Aucun (baseline pré-système)
