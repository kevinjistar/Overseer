
---
Document: Workflow_Engine_Schema
Version: 2.0.0
Date: 2025-12-11

PolicyVersions:
  WorkflowPolicy: 1.0.0
  ValidationPolicy: 1.0.0
  VersioningPolicy: 1.0.0
  CorrectionPolicy: 1.0.0

Changelog:
  - 2.0.0 (2025-12-11): Refonte majeure du Workflow Engine pour séparer logique métier (Overseer) et exécution structurelle (orchestrateur). Suppression des conditions dynamiques du schéma. Ajout du concept de transitions structurelles contrôlées par Overseer.
  - 1.0.0 (2025-12-10): Version initiale du Workflow Engine.

Breaking Changes:
  - Les conditions métier ne sont plus représentées dans le Workflow Engine.
  - Le moteur ne décide plus d’aucune transition. Il exécute uniquement celles validées par Overseer.
  - Les actions ne sont plus interprétées comme logique métier, seulement comme triggers structurels.
---

1. Objet du document

Ce document définit la version 2.0.0 du Workflow Engine, désormais structurée pour refléter la séparation stricte entre logique métier (Overseer) et exécution structurelle (orchestrateur).

Le Workflow Engine n’est plus un moteur décisionnel.  
Il devient une **matrice d’états déclaratifs**, appliquée exclusivement par l’orchestrateur **sur ordre explicite d’Overseer**.


2. Principes fondamentaux

2.1 Aucune logique métier dans le Workflow Engine  
Le Workflow Engine ne:
• décide rien,  
• n’analyse rien,  
• ne valide aucune condition métier,  
• ne déclenche aucune transition de sa propre initiative.

2.2 Overseer est l’unique moteur logique  
• Évalue les conditions métiers dynamiques  
• Détermine si une transition a du sens  
• Vérifie l’impact sur le projet  
• Prend la décision finale de déclenchement

2.3 L’orchestrateur est l’unique moteur structurel  
• Vérifie que la transition existe dans la table  
• Vérifie l'état actuel  
• Applique la transition  
• Loggue l’événement  
• Déclenche les actions structurelles

2.4 Workflow Engine = description structurelle  
Il contient:
• la liste des états possibles,  
• la liste des transitions permises (structurellement),  
• les actions structurelles déclenchées une fois la transition approuvée.  


3. Structure du Workflow Engine

Le Workflow Engine est défini ainsi:

{
  "initialState": "string",
  "states": [
    {
      "id": "string",
      "label": "string",
      "meta": { ... }
    }
  ],
  "transitions": [
    {
      "id": "string",
      "from": "stateId",
      "to": "stateId",
      "actions": [
        {
          "type": "snapshot | log | callAgent | none",
          "params": { ... }
        }
      ]
    }
  ]
}

3.1 États  
Les états sont purement déclaratifs.  
Aucune logique métier n’y est attachée.

3.2 Transitions  
Une transition représente un déplacement structurel permis dans le graphe.

Une transition n’a plus:
• de conditions métiers,  
• de logique d’éligibilité,  
• de triggers automatiques dépendant du contenu.

3.3 Actions  
Les actions sont strictement structurelles:
• snapshot,  
• log,  
• callAgent structuré (agent préparé par Overseer),  
• mise à jour méta structurelle.

Aucune action métier ne doit apparaître.


4. Rôle d’Overseer dans le workflow

Overseer:
• évalue les conditions métier (hors schéma workflow),  
• décide si une transition doit avoir lieu,  
• passe explicitement l'ordre “runTransition” à l’orchestrateur.

Overseer peut:
• bloquer une transition même si elle existe dans le schéma,  
• demander une transition exceptionnelle si Policy l’autorise,  
• utiliser SuperiorValidationAgent pour vérifier la cohérence.


5. Rôle de l’orchestrateur dans le workflow

Lorsqu’il reçoit l’ordre d’Overseer:

L’orchestrateur:
• vérifie que la transition existe dans le Workflow Engine,  
• vérifie que l’état actuel correspond à “from”,  
• applique la transition,  
• exécute les actions structurelles,  
• loggue,  
• snapshot si demandé,  
• ne fait aucune évaluation métier.

Si la transition n’existe pas → erreur structurelle.  
Si l’état ne correspond pas → erreur structurelle.  
Si une action est invalide structurellement → erreur structurelle.


6. Exemple d’une transition déclarative

{
  "id": "approve-strategy",
  "from": "draft",
  "to": "validated",
  "actions": [
    { "type": "snapshot" },
    { "type": "log", "params": { "message": "Strategy validated" } }
  ]
}

Ce que cela signifie:
• la transition est structurellement permise,  
• Overseer déterminera si elle est métier-ment valide,  
• l’orchestrateur l’exécutera mécaniquement si Overseer l'ordonne.


7. Gestion du mode correction

En mode correction:
• Overseer n’ordonne aucune transition,  
• Toutes transitions reçues par l’orchestrateur sont refusées,  
• Les actions structurelles sont désactivées sauf log,  
• Aucune progression de workflow n’est permise.

Le Workflow Engine doit donc intégrer:

"modeRestrictions": {
  "correction": {
    "allowTransitions": false,
    "allowedActions": [ "log" ]
  }
}


8. Invariants du Workflow Engine v2.0.0

• Aucune condition métier dans le schéma  
• Aucune évaluation dynamique  
• Aucune logique décisionnelle  
• Transitions purement déclaratives  
• Overseer = moteur métier  
• Orchestrateur = moteur structurel  
• SuperiorValidationAgent = vérificateur métier  
• Respect strict des Policies actives  
• Déterminisme complet du graphe d’états  


Fin du document.
