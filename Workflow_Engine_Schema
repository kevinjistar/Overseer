---
Document: Workflow_Engine_Schema
Version: 1.0.0
Date: 2025-12-20

PolicyVersions:
  ValidationPolicy_Global: 1.0.0
  WorkflowPolicy: 1.0.0
  CorrectionMode_Policy: 1.0.0
  System_Agent_Edit_Policy: 1.0.0
---

# Workflow_Engine_Schema

## 1. Objet du document

Ce document définit le schéma normatif du Workflow Engine utilisé par Overseer.

Le Workflow Engine est une structure strictement déclarative d’états et de transitions.  
Il ne contient aucune logique métier, n’évalue aucune condition métier et ne déclenche aucune transition de sa propre initiative.

L’état courant exécutable est porté exclusivement par workflowEngine/engine.json.

## 2. Acteurs et responsabilités

### 2.1 Overseer

Overseer:
- décide si une transition doit être exécutée, sur base de logique métier externe au Workflow Engine,
- n’ordonne une transition à l’orchestrateur que si elle est permise par WorkflowPolicy,
- ne modifie jamais directement le Workflow Engine en base.

### 2.2 Orchestrateur

L’orchestrateur:
- est le seul composant autorisé à écrire l’état du Workflow Engine en base,
- applique mécaniquement une transition uniquement sur ordre explicite d’Overseer,
- rejette toute transition inexistante, incohérente avec l’état courant ou structurellement invalide,
- n’évalue aucune logique métier.

### 2.3 SuperiorValidationAgent

SuperiorValidationAgent:
- n’exécute aucune transition,
- n’interprète aucune action structurelle,
- produit uniquement des verdicts sémantiques utilisés par Overseer.

## 3. Définition normative du schéma

### 3.1 Contraintes générales

- Le graphe est défini par une liste d’états et une liste de transitions.
- Toute transition référence exclusivement des états existants.
- Aucune condition métier ne figure dans le schéma.
- Les actions associées aux transitions sont strictement structurelles.

### 3.2 Modèle JSON normatif

Le Workflow Engine est un objet JSON conforme à la structure suivante:

{
  "initialState": "string",
  "currentState": "string",
  "states": [
    {
      "id": "string",
      "label": "string",
      "meta": { }
    }
  ],
  "transitions": [
    {
      "id": "string",
      "from": "string",
      "to": "string",
      "actions": [
        {
          "type": "snapshot | log | callAgent | none",
          "params": { }
        }
      ]
    }
  ],
  "modeRestrictions": {
    "correction": {
      "allowTransitions": false,
      "allowedActions": [ "log" ]
    }
  }
}

### 3.3 Règles sur initialState et currentState

- initialState est obligatoire et doit correspondre à un states[].id existant.
- currentState est obligatoire en phase d’exécution et doit correspondre à un states[].id existant.
- Lors de l’initialisation d’un projet, si currentState n’est pas encore défini, l’orchestrateur doit l’initialiser égal à initialState lors de la première écriture.

### 3.4 Règles sur states

- states[].id est unique.
- states[].label est obligatoire et strictement descriptif.
- states[].meta, s’il existe, ne contient aucune règle métier, condition ou déclencheur.

### 3.5 Règles sur transitions

- transitions[].id est unique.
- transitions[].from et transitions[].to référencent des states[].id existants.
- Aucune transition ne contient de conditions, triggers ou règles métier.
- Une transition n’est jamais auto-déclenchée.

### 3.6 Règles sur actions

- Une action est strictement structurelle.
- Types autorisés:
  - snapshot, création d’un snapshot par l’orchestrateur,
  - log, écriture d’un événement structuré,
  - callAgent, création d’une tâche d’appel agentique (sans appel direct LLM),
  - none, aucune action.
- params est optionnel et ne contient aucune logique métier implicite.

## 4. Exécution normative d’une transition

### 4.1 Préconditions

Overseer doit ordonner explicitement la transition.

L’orchestrateur vérifie:
- l’existence de la transition,
- la cohérence entre currentState et transition.from,
- l’existence de transition.to,
- la validité structurelle des actions.

### 4.2 Application

Si toutes les conditions structurelles sont valides:
- mise à jour de currentState vers transition.to,
- exécution séquentielle des actions déclarées,
- journalisation complète.

En cas d’erreur structurelle:
- aucune modification d’état n’est appliquée.

### 4.3 Interdictions

- aucune condition métier n’est évaluée,
- aucune transition n’est déclenchée par un agent,
- aucune transition n’est auto-déclenchée par le Workflow Engine.

## 5. Mode correction

### 5.1 Règle principale

Lorsque correctionMode = true:
- Overseer n’ordonne aucune transition,
- l’orchestrateur refuse toute exécution de transition.

### 5.2 Restrictions d’actions

En mode correction:
- seules les actions listées dans modeRestrictions.correction.allowedActions sont autorisées,
- par défaut, seule l’action log est autorisée.

### 5.3 Interdictions

- aucune progression de workflow,
- aucune action callAgent déclenchée via une transition,
- aucune modification d’état.

## 6. Exemple normatif

{
  "id": "approve-strategy",
  "from": "draft",
  "to": "validated",
  "actions": [
    { "type": "snapshot", "params": { } },
    { "type": "log", "params": { "message": "Strategy validated" } }
  ]
}

Signification:
- la transition est structurellement valide si déclarée,
- Overseer décide de son exécution,
- l’orchestrateur l’exécute mécaniquement sur ordre explicite.

## 7. Invariants

Toujours vrais:

- aucune logique métier dans le Workflow Engine,
- aucune décision autonome,
- transitions strictement déclaratives,
- workflowEngine/engine.json est l’unique porteur d’état courant,
- Overseer est l’autorité métier,
- l’orchestrateur est l’autorité structurelle,
- SuperiorValidationAgent ne déclenche jamais d’exécution,
- toute transition est explicitement ordonnée par Overseer,
- aucune transition n’est exécutée en mode correction.

---
Fin du document
---

Document Metadata & Changelog

Changelog:
  - 1.0.0 (2025-12-20) : Initialisation de la version de référence du document.

Breaking Changes:
  - Aucun (baseline pré-système)
