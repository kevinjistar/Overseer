---
Document: Pipeline_d_entree_des_projets
Version: 1.0.0
Date: 2025-12-20

PolicyVersions:
  ValidationPolicy_Global: 1.0.0
  WorkflowPolicy: 1.0.0
  CorrectionMode_Policy: 1.0.0
  System_Agent_Edit_Policy: 1.0.0
---

1. Objet du document

Ce document définit le pipeline normatif et obligatoire d’entrée d’un projet dans Overseer.

Ce pipeline décrit, de manière contractuelle:
• quelles opérations sont requises pour qu’un projet soit considéré comme introduit,
• qui exécute chaque opération (Overseer, orchestrateur),
• ce qui est interdit tant que le pipeline n’est pas terminé,
• les préconditions d’activation du projet comme currentProject.

Ce pipeline est obligatoire pour:
• la création d’un nouveau projet,
• l’import d’un projet existant,
• la duplication d’un projet modèle.

Un projet qui n’a pas été introduit via ce pipeline est considéré comme inexploitable. Aucun agent ne peut être appelé sur un projet inexploitable.

---

Règle d’immuabilité du cahier des charges

Le document Cahier_des_charges_new_project est immuable après création. Aucune entité ne le modifie.

Toute structuration, reformattage ou extraction d’information est effectuée via un AgentTransformateur et produit un artefact éphémère non persisté, nommé RefinedBrief.

2. Acteurs et responsabilités

2.1 Utilisateur
L’utilisateur:
• exprime une intention d’entrée (création, import, duplication),
• fournit les informations initiales requises.

L’utilisateur ne:
• n’écrit jamais en base,
• ne crée jamais un projectId,
• n’active jamais un projet directement.

2.2 Overseer
Overseer:
• reçoit l’intention utilisateur,
• vérifie la complétude minimale des entrées,
• ordonne explicitement à l’orchestrateur l’exécution des opérations structurelles,
• décide explicitement tout appel agentique autorisé par ce pipeline,
• bloque toute écriture Firestore tant que les conditions normatives de validation ne sont pas satisfaites,
• valide que les sorties structurelles requises existent,
• décide l’activation du currentProject.

Overseer ne:
• ne crée jamais la structure Firestore,
• n’écrit jamais directement en base,
• ne génère jamais directement les documents initiaux.

2.3 Orchestrateur
L’orchestrateur:
• est la seule couche autorisée à écrire dans Firestore,
• exécute exclusivement des opérations structurelles ordonnées par Overseer,
• exécute les appels d’agents uniquement sur ordre explicite d’Overseer, et journalise ces appels,
• crée la structure projet, le workflowEngine minimal, les snapshots initiaux et les logs initiaux,
• retourne un statut structuré à Overseer.

L’orchestrateur ne:
• ne décide jamais si un projet doit être créé, importé ou dupliqué,
• n’interprète jamais l’intention métier,
• n’appelle jamais de LLM.

2.4 Agents
Les agents:
• peuvent être appelés uniquement dans les conditions explicites définies par la section “Étapes normatives du pipeline”,
• ne sont jamais appelés par initiative orchestrateur,
• ne peuvent jamais écrire dans Firestore.

---

3. Définitions opérationnelles

3.1 Projet exploitable
Un projet est exploitable si, et seulement si:
• la structure Firestore minimale est créée,
• les documents référents initiaux existent et sont structurellement valides,
• projects/{projectId}/workflowEngine/engine.json existe, est prêt et initialisé, et porte l’état courant via currentState,
• un snapshot initial existe,
• un log de création existe,
• Overseer a explicitement marqué le projet comme currentProject si l’utilisateur l’a demandé.

3.2 Clôture du pipeline
Le pipeline est clôturé uniquement lorsque Overseer a confirmé que toutes les sorties requises existent et sont conformes.

---

4. Préconditions bloquantes

Le pipeline ne peut pas démarrer si:
• halted = true,
• correctionMode = true, sauf si l’entrée du projet est explicitement ordonnée comme action de stabilisation (cas exceptionnel, documenté et journalisé),
• l’identifiant utilisateur n’est pas disponible pour l’écriture de userContext, si l’activation currentProject est demandée.

---

5. Entrées requises

5.1 Entrées minimales fournies par l’utilisateur
Selon le mode d’entrée:
• création: name, description (au minimum),
• import: source déclarée et payload d’import structuré,
• duplication: projectId source ou templateId.

5.2 Entrées générées et gouvernées par le système
• projectId: généré de façon déterministe côté orchestrateur sur ordre d’Overseer,
• createdAt: généré à l’écriture,
• status initial: défini à la création selon le schéma projet.

Interdiction:
• aucun agent, aucun utilisateur, aucun composant autre que l’orchestrateur n’écrit ces valeurs en base.

---

6. Sorties requises

À la fin du pipeline, les artefacts suivants doivent exister en base:

6.1 Structure projet minimale
projects/{projectId}/
meta/
documents/
workflowEngine/
logs/
settings/

6.2 Document projet (métadonnées)
projects/{projectId}/meta/project.json conforme à Schema_Project.

6.3 Documents référents initiaux
projects/{projectId}/documents/
architecture.json
ux.json
strategy.json
workflowDocument.json
notes.json

Chaque document:
• respecte le Schéma universel du Document Référent et son module spécialisé,
• est complet, au format JSON strict,
• possède une meta conforme et initialisée.

Règle normative:
• workflowDocument.json est un document descriptif, non exécutable, il ne porte jamais l’état courant et ne peut pas être interprété comme moteur d’état.

6.4 Workflow Engine minimal
projects/{projectId}/workflowEngine/engine.json conforme au schéma workflow en vigueur, et contenant currentState.

6.5 Snapshots initiaux
Au minimum:
• snapshot du meta projet,
• snapshot des documents référents initiaux,
• snapshot du workflow engine initial.

6.6 Logs initiaux
Au minimum:
• logs/creation ou équivalent déclaré,
• un événement global de création conforme aux conventions de journalisation.

6.7 Activation du currentProject (optionnel)
Si l’utilisateur l’a explicitement demandé:
userContext/{userId}/currentProject.json est écrit et pointe vers projectId.

---

7. Étapes normatives du pipeline

Étape 1: Réception du cahier des charges (utilisateur)
- Entrée: Cahier_des_charges_new_project (immuable)

Étape 2: Structuration optionnelle du cahier des charges
2.1 Décision d’appel
- Décision explicite d’Overseer
- L’orchestrateur n’initie jamais cet appel

2.2 Exécution
- L’orchestrateur exécute l’appel d’agent
- Log obligatoire:
  - actor = orchestrator
  - initiatedBy = userId | system
  - details.calledAgent = cahier_des_charges_agent
- Output: RefinedBrief (éphémère, non persisté)

2.3 Statuts et comportements
- Si status = structured: poursuivre le pipeline
- Si status = needs_clarification: arrêt du pipeline; Overseer retourne à l’utilisateur avec les ambiguïtés détectées
- Si status = cannot_structure_without_loss: création abandonnée; aucune écriture Firestore

Étape 3: Génération assistée optionnelle
3.1 Condition
- Décision explicite d’Overseer (et éventuellement demande utilisateur)

3.2 Génération (documents candidats)
- Appel BrandingStrategyAgent, production d’un strategy candidat
  - Log obligatoire:
    - actor = orchestrator
    - initiatedBy = userId | system
    - details.calledAgent = branding_strategy_agent
- Appel PRDGeneratorAgent, production d’un notes candidat
  - Log obligatoire:
    - actor = orchestrator
    - initiatedBy = userId | system
    - details.calledAgent = prd_generator_agent

3.3 Validation structurelle
- L’orchestrateur valide structurellement chaque document candidat avant toute validation sémantique.

Étape 4: Baseline blank non persisté (création assistée uniquement)
- L’orchestrateur génère un originalDocument blank non persisté pour chaque document candidat afin de permettre diff et validation en création:
  - meta.version = 0.0.0
  - meta.status = draft
  - meta.ownerAgent = system_init

Étape 5: Validation sémantique globale (création assistée uniquement)
- SuperiorValidationAgent valide la cohérence entre:
  - cahier des charges immuable
  - RefinedBrief (si présent)
  - documents candidats (strategy, notes)
- Si verdict = block: création refusée; aucune écriture Firestore
- Si verdict = warn: Overseer décide; journalisation obligatoire
- Si verdict = allow: poursuivre

Étape 6: Création structure Firestore
- Création arborescence projet et documents référents
- Création obligatoire de projects/{projectId}/workflowEngine/engine.json

Étape 7: Écriture des documents
- Écriture atomique via orchestrateur
- Aucun agent n’écrit en base

Étape 8: Snapshot initial obligatoire

Étape 9: Activation projet

---

8. Conditions d’échec et comportement attendu

8.1 Échec structurel détecté par l’orchestrateur
Si l’orchestrateur détecte une non-conformité structurelle:
• aucune étape suivante n’est exécutée,
• un statut d’erreur structuré est renvoyé à Overseer,
• aucune clôture n’est possible.

8.2 Échec de vérification détecté par Overseer
Si Overseer détecte un artefact manquant ou incohérent:
• le projet est marqué comme inexploitable,
• le projet n’est pas activé comme currentProject,
• aucune action agentique n’est autorisée sur ce projet.

---

9. Règles immuables

Les règles suivantes sont non négociables:

1. Aucun projet n’est exploitable tant que le pipeline n’est pas clôturé par Overseer.
2. Aucun agent n’est appelé sur un projet persistant tant que le snapshot initial n’existe pas.
3. Le versioning initial des documents référents persistés est toujours "1.0.0".
4. ownerAgent = "system_init" pour l’initialisation des documents référents persistés.
5. projects/{projectId}/workflowEngine/engine.json existe, est prêt et initialisé, et porte currentState avant toute action d’agent sur un projet persistant.
6. Le currentProject est défini uniquement via une activation explicite, écrite par l’orchestrateur sur ordre d’Overseer.
7. Aucun composant autre que l’orchestrateur n’écrit dans Firestore.

---

10. Invariants

Toujours vrais:

• Aucune écriture Firestore n’a lieu sans ordre explicite d’Overseer.
• Toute création assistée, si activée, respecte strictement l’immuabilité du cahier des charges et la non persistance des artefacts transformateurs.
• L’existence des documents référents initiaux, de projects/{projectId}/workflowEngine/engine.json prêt et initialisé, des snapshots initiaux et des logs initiaux est une condition obligatoire d’exploitabilité.
• workflowDocument.json est descriptif, non exécutable, et ne porte jamais l’état courant.
• Après création, aucune synchronisation automatique projects/{projectId}/workflowEngine/engine.json ↔ Workflow Documents.

---

Politique hypothèses (création assistée)

Tout contenu généré qui n’est pas explicitement traçable au cahier des charges doit être placé dans un champ “assumptions” et inclure:
• rationale (obligatoire)
• requiresValidation: true (obligatoire)

Tout contenu “factual” doit inclure:
• sourceRef (obligatoire)

SuperiorValidationAgent vérifie:
• factual sans sourceRef: block
• assumptions sans rationale: block

---
Fin du document
---

Document Metadata & Changelog

Changelog:
  - 1.0.0 (2025-12-20) : Initialisation de la version de référence du document.

Breaking Changes:
  - Aucun (baseline pré-système)
