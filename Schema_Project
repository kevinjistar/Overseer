---
Document: Schema_Project
Version: 2.1.0
Date: 2025-12-18

PolicyVersions:
  ValidationPolicy_Global: 1.0.0
  WorkflowPolicy: 1.0.0
  CorrectionMode_Policy: 1.0.0
  System_Agent_Edit_Policy: 1.0.0
---

1. Objet du document

Ce document définit le schéma normatif du Projet (ProjectSchema) utilisé par Overseer et l’orchestrateur.

Ce document:
• fixe la structure minimale et stable d’un Projet,  
• définit les champs obligatoires, leur rôle, et les contraintes structurelles associées,  
• sert de référence unique pour la validation structurelle côté orchestrateur,  
• ne définit aucune logique métier, aucune règle de décision, aucun pipeline opérationnel.

Ce schéma s’applique aux objets Projet persistés dans Firestore au sein de projects/{projectId}/meta/project.json et à tout objet Projet équivalent manipulé par le système.

---

2. Définition du Projet

Un Projet est un conteneur structuré regroupant:
• des métadonnées projet (meta),  
• des documents référents (documents),  
• un workflowEngine exécutable portant l’état courant (workflowEngine),  
• des paramètres structurels (settings),  
• un état de synchronisation externe (sync),  
• des logs structurés (logs).

Règles normatives:
• workflowEngine est l’unique porteur d’état courant exécutable, snapshotable, restaurable.  
• Les documents de type “Workflow Document” ne portent jamais l’état courant, ils sont des descripteurs uniquement.  
• Toute lecture de l’état courant et toute exécution de transition s’effectuent depuis workflowEngine/engine.json, jamais depuis un document workflow.

Un Projet n’est pas:
• un document référent (il les contient),  
• une Policy,  
• un workflow métier autonome.

---

3. Responsabilités et interdictions

3.1 Overseer  
Overseer:
• décide des opérations métier relatives au projet,  
• ordonne les mutations via l’orchestrateur,  
• n’écrit jamais directement en base,  
• ne modifie jamais un Projet sans passer par un pipeline officiel.

3.2 Orchestrateur  
L’orchestrateur:
• est la seule couche autorisée à écrire en base,  
• valide la conformité structurelle au présent schéma lors des écritures,  
• n’interprète aucune logique métier,  
• refuse toute mutation non conforme,  
• charge l’état courant et exécute les transitions uniquement depuis workflowEngine/engine.json, sur ordre explicite d’Overseer.

3.3 Agents  
Les agents:
• ne créent pas, ne modifient pas et ne patchent pas la structure d’un Projet en base,  
• ne décident jamais la structure d’un Projet,  
• ne déduisent aucun champ, aucune valeur, aucune compatibilité,  
• ne lisent pas et ne déduisent pas l’état courant depuis un document workflow.

Toute production agentique, si elle existe dans un pipeline, reste un artefact intermédiaire soumis à validation structurelle par l’orchestrateur et décision finale par Overseer.

3.4 Interdictions structurelles  
Il est interdit de:
• supprimer un bloc racine requis (meta, documents, workflowEngine, settings, sync, logs),  
• ajouter un bloc racine non déclaré,  
• modifier le sens d’un champ par renommage implicite,  
• rendre optionnel un champ requis par ce schéma,  
• introduire un porteur d’état courant hors workflowEngine.

---

4. Structure conceptuelle normative

Structure conceptuelle (référence de lecture, non exécutable):

Projet {
  meta {
    id
    name
    description
    createdAt
    updatedAt
    version
    status
  }

  documents {
    architecture: Document[]
    ux: Document[]
    strategy: Document[]
    workflow: Document[]
    notes: Document[]
  }

  workflowEngine {
    engineId
    currentState
    engineRef
  }

  settings {
    agentsAllowed[]
    versioning
    constraints[]
  }

  sync {
    lastExternalSyncAt
    lastExternalSource
    lastSyncPayload
  }

  logs {
    events: LogEntry[]
    syncHistory: SyncEntry[]
  }
}

Notes normatives:
• Document[] référence des documents conformes au Schéma universel du Document Référent (référence externe),  
• les documents sous documents.workflow ne définissent jamais l’état courant, ils sont non exécutifs,  
• LogEntry et SyncEntry sont des objets structurés locaux au présent schéma,  
• workflowEngine est l’unique porteur d’état courant, toute transition se fait depuis workflowEngine/engine.json.

---

5. Contraintes structurelles par bloc

5.1 meta  
Rôle: gouvernance, traçabilité, versioning du Projet.

Contraintes:
• meta.id est l’identifiant stable du Projet, il ne doit pas être modifié par une mise à jour,  
• meta.createdAt ne doit pas être modifié après création,  
• meta.version est obligatoire et suit un format X.Y.Z,  
• meta.status est limité à active ou archived.

5.2 documents  
Rôle: pointeurs vers les documents référents versionnés du projet.

Contraintes:
• les clés autorisées sont strictement: architecture, ux, strategy, workflow, notes,  
• chaque entrée est un tableau, y compris si une seule version existe,  
• chaque item doit référencer un DocumentSchema résoluble et validable,  
• documents.workflow (ou l’équivalent utilisé pour les Workflow Documents) est optionnel,  
• documents.workflow peut être une liste vide,  
• les documents sous documents.workflow ne définissent jamais l’état courant, ils sont non exécutifs.

Règle normative de nommage et stockage des Workflow Documents:
• stockage sous projects/{projectId}/documents/  
• format workflowDocument_{descripteur}.json

5.3 workflowEngine  
Rôle: état exécutable unique du workflow projet.

Contraintes:
• workflowEngine.engineId est obligatoire et identifie de manière stable l’engine,  
• workflowEngine.currentState est obligatoire et porte l’état courant unique,  
• workflowEngine.engineRef est obligatoire et référence l’engine exécutable,  
• aucun champ d’état courant ne doit exister ailleurs dans le Projet.

5.4 settings  
Rôle: contraintes structurelles projet.

Contraintes:
• agentsAllowed est obligatoire et liste des identifiants d’agents autorisés par politique locale,  
• versioning est obligatoire et borné à auto dans ce schéma,  
• constraints est optionnel et liste des identifiants de contraintes déclaratives.

5.5 sync  
Rôle: état de synchronisation externe, structure uniquement.

Contraintes:
• lastExternalSyncAt, lastExternalSource, lastSyncPayload sont requis,  
• aucune interprétation métier du payload n’est définie ici.

5.6 logs  
Rôle: traces structurelles.

Contraintes:
• events et syncHistory sont des tableaux d’objets structurés,  
• la sémantique des logs est hors périmètre, seule la structure est normative ici.

---

6. JSON Schema normatif

JSON Schema de référence, destiné à la validation structurelle.

{
  "title": "ProjectSchema",
  "type": "object",
  "required": ["meta", "documents", "workflowEngine", "settings", "sync", "logs"],
  "properties": {
    "meta": {
      "type": "object",
      "required": ["id", "name", "createdAt", "version", "status"],
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "description": { "type": "string" },
        "createdAt": { "type": "string" },
        "updatedAt": { "type": "string" },
        "version": { "type": "string" },
        "status": { "type": "string", "enum": ["active", "archived"] }
      }
    },

    "documents": {
      "type": "object",
      "properties": {
        "architecture": { "type": "array", "items": { "$ref": "DocumentSchema" } },
        "ux": { "type": "array", "items": { "$ref": "DocumentSchema" } },
        "strategy": { "type": "array", "items": { "$ref": "DocumentSchema" } },
        "workflow": { "type": "array", "items": { "$ref": "DocumentSchema" } },
        "notes": { "type": "array", "items": { "$ref": "DocumentSchema" } }
      }
    },

    "workflowEngine": {
      "type": "object",
      "required": ["engineId", "currentState", "engineRef"],
      "properties": {
        "engineId": { "type": "string" },
        "currentState": { "type": "string" },
        "engineRef": { "type": "string" }
      }
    },

    "settings": {
      "type": "object",
      "required": ["agentsAllowed", "versioning"],
      "properties": {
        "agentsAllowed": { "type": "array", "items": { "type": "string" } },
        "versioning": { "type": "string", "enum": ["auto"] },
        "constraints": { "type": "array", "items": { "type": "string" } }
      }
    },

    "sync": {
      "type": "object",
      "required": ["lastExternalSyncAt", "lastExternalSource", "lastSyncPayload"],
      "properties": {
        "lastExternalSyncAt": { "type": "string" },
        "lastExternalSource": { "type": "string" },
        "lastSyncPayload": { "type": "string" }
      }
    },

    "logs": {
      "type": "object",
      "properties": {
        "events": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "timestamp": { "type": "string" },
              "agent": { "type": "string" },
              "action": { "type": "string" },
              "details": { "type": "string" }
            }
          }
        },
        "syncHistory": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "timestamp": { "type": "string" },
              "source": { "type": "string" },
              "payload": { "type": "string" },
              "result": { "type": "string" }
            }
          }
        }
      }
    }
  }
}

Contraintes de référence:
• DocumentSchema et WorkflowSchema sont des références externes qui doivent être résolues par le validateur structurel utilisé,  
• aucune substitution implicite de ces références n’est autorisée.

---

7. Invariants

Toujours vrais:

• Un Projet contient exactement les blocs racine définis par ce schéma, aucun autre bloc racine n’est autorisé.  
• meta.id et meta.createdAt sont immuables après création.  
• meta.version existe toujours et suit un format X.Y.Z.  
• documents contient uniquement les catégories déclarées (architecture, ux, strategy, workflow, notes).  
• workflowEngine est l’unique porteur de currentState.  
• workflowEngine est l’unique porteur d’état courant exécutable, snapshotable, restaurable.  
• Les Workflow Documents ne portent aucun état exécutable.  
• Les documents sous documents.workflow ne portent jamais l’état courant, ils sont non exécutifs.  
• Aucun agent ne modifie un Projet en base.  
• Toute écriture de Projet passe par l’orchestrateur et doit être validée structurellement.  
• Le présent schéma ne définit aucune logique métier et ne peut pas être interprété comme tel.  
• Toute lecture de l’état courant et toute exécution de transition s’effectuent depuis workflowEngine/engine.json, jamais depuis un document workflow.

---
Fin du document
---

Document Metadata & Changelog

Changelog:
  - 2.1.0 (2025-12-18): Clarification normative de l’optionalité de documents.workflow (liste vide autorisée), ajout de la règle de nommage workflowDocument_{descripteur}.json, ajout d’invariants explicites sur currentState et le statut non exécutable des Workflow Documents.
  - 2.0.0 (2025-12-17): Alignement normatif sur workflowEngine comme unique état exécutable, suppression de toute représentation d’état parallèle via workflows, clarification du statut non exécutif des Workflow Documents.
  - 1.1.0 (2025-12-09): Mise à jour complète du Schéma Projet, ajout versioning, logs système, états workflows, compatibilité Sync
  - 1.0.0 (2025-12-09): Création du schéma initial

Breaking Changes: 
  - Aucun depuis 2.0.0
  - Toute lecture de l’état courant via workflows ou via un document workflow est désormais invalide.
  - Suppression de la section workflows conceptuelle en tant que porteur d’état.
