---
Document: Process_de_chargement_du_contexte_et_des_documents
Version: 1.0.0
Date: 2025-12-20

PolicyVersions:
  ValidationPolicy_Global: 1.0.0
  WorkflowPolicy: 1.0.0
  CorrectionMode_Policy: 1.0.0
  System_Agent_Edit_Policy: 1.0.0
---

1. Objet du document

Ce document définit le process normatif de chargement du contexte projet et des documents référents avant toute exécution agentique dans Overseer.

Ce process est obligatoire. Aucun appel d'agent producteur, aucune validation sémantique, et aucune décision de mise à jour documentaire ne doit être exécuté sans un contexte chargé selon ce process.

2. Définitions

2.1 Contexte
Le contexte est l'ensemble des données nécessaires et suffisantes pour qu'Overseer prépare une instruction, qu'un agent exécute une tâche, et que SuperiorValidationAgent rende un verdict sémantique, sans ambiguïté sur le projet ciblé.

2.2 Documents référents attendus
Les documents référents attendus sont ceux du projet actif, stockés sous projects/{projectId}/documents/, et nécessaires au fonctionnement normal du pipeline.

2.3 currentProject
currentProject est la référence explicite du projet actif pour un utilisateur. Il est stocké sous userContext/{userId}/currentProject.json et constitue l'unique source d'autorité de sélection.

3. Acteurs et responsabilités

3.1 Overseer
Overseer:
- refuse toute opération si aucun currentProject actif n'est défini,
- ordonne explicitement le chargement de contexte à l'orchestrateur,
- consomme le contexte renvoyé par l'orchestrateur pour préparer les instructions,
- décide de poursuivre, de bloquer, ou de basculer en mode correction selon les anomalies détectées.

Overseer n'effectue aucune lecture Firestore directe au titre de ce process.

3.2 Orchestrateur
L'orchestrateur:
- effectue toutes les lectures Firestore nécessaires au chargement,
- assemble un contexte complet et structuré,
- applique des validations strictement structurelles pendant le chargement,
- renvoie à Overseer un résultat structuré (succès, warning, ou erreur structurelle).

L'orchestrateur n'interprète aucune logique métier pendant ce process.

3.3 ContextAgent

Règle normative ContextAgent :
- ContextAgent est optionnel.
- ContextAgent est appelé uniquement sur décision explicite d’Overseer.
- L’orchestrateur ne déclenche jamais ContextAgent de manière autonome.
- La synthèse produite est éphémère et n’est jamais persistée, seules des métadonnées d’appel peuvent être journalisées.

ContextAgent:
- est un AgentTransformateur,
- ne lit pas Firestore,
- ne modifie jamais Firestore,
- ne modifie pas le contexte source,
- produit uniquement une synthèse ou une préparation de contexte sur la base des données explicitement fournies par Overseer ou l'orchestrateur,
- output éphémère, non versionné, non persisté,
- est appelé uniquement sur ordre explicite d’Overseer.

ContextAgent est défini par ContextAgent_spec. Sans ce document, ContextAgent est considéré inexistant.

ContextAgent n'est jamais un validateur sémantique. Toute validation sémantique est du ressort de SuperiorValidationAgent.

3.4 Critères de déclenchement

ContextAgent peut être appelé uniquement si Overseer l’ordonne explicitement, avec exactement l’un des déclencheurs suivants:
- contextQuality = warning
- contexte très volumineux (> 50 documents référents)
- opération critique (validation globale, mode correction)
- demande explicite utilisateur via Overseer

4. Préconditions et refus immédiat

4.1 Préconditions obligatoires
Le chargement du contexte ne peut démarrer que si les conditions suivantes sont simultanément vraies:
- un currentProject est défini avec status = "active",
- projectId est non vide et correspond à un projet existant,
- aucune condition de blocage structurel n'est signalée par l'orchestrateur pour ce projet, y compris un état halted si présent dans le runtime système,
- les documents référents attendus existent en base, au minimum sous forme de placeholders conformes,
- projects/{projectId}/workflowEngine/engine.json existe et est lisible, sinon arrêt immédiat.

4.2 Refus immédiat
Si une précondition échoue:
- l'orchestrateur renvoie une erreur structurelle à Overseer,
- Overseer n'ordonne aucun appel agentique,
- Overseer déclenche le processus de correction approprié, sans tenter de contourner le chargement.

5. Entrée et sortie attendues

5.1 Ordre d'entrée
Overseer envoie à l'orchestrateur un ordre formel contenant au minimum:
{
  "type": "loadProjectContext",
  "userId": "string",
  "operationId": "string",
  "projectId": "string"
}

5.2 Sortie de l'orchestrateur
Succès:
{
  "status": "contextLoaded",
  "projectId": "string",
  "contextQuality": "ok",
  "context": { ... }
}

Warning:
{
  "status": "contextLoaded",
  "projectId": "string",
  "contextQuality": "warning",
  "warnings": [ ... ],
  "context": { ... }
}

Erreur structurelle:
{
  "status": "error",
  "projectId": "string",
  "errorType": "MissingCurrentProject | MissingProject | MissingDocuments | SchemaViolation | JsonInvalid | Halted",
  "details": "string"
}

6. Étapes normatives du chargement

6.1 Lecture du currentProject
L'orchestrateur lit exactement:
userContext/{userId}/currentProject.json

Contraintes:
- status doit être "active",
- projectId doit être identique au projectId reçu dans l'ordre, si celui-ci est fourni.

6.2 Chargement du meta projet
L'orchestrateur charge:
projects/{projectId}/meta/project.json

Validation structurelle minimale:
- présence des champs d'identité du projet,
- cohérence du projectId,
- absence de JSON invalide.

6.3 Chargement des documents référents
L'orchestrateur charge les documents référents attendus sous:
projects/{projectId}/documents/

Validation structurelle obligatoire pour chaque document chargé:
- conformité au schéma universel du Document Référent,
- présence des zones meta, structured, specialized, narrative, links,
- cohérence meta.projectId avec projectId,
- absence de clés inconnues,
- versioning structurel parseable et non vide.

Règle normative:
- Le document workflow est chargé uniquement à des fins descriptives, il ne peut pas être interprété comme état courant.

Toute incohérence structurelle sur un document attendu provoque un arrêt immédiat du chargement avec erreur structurelle.

6.4 Chargement du Workflow Engine
Étape obligatoire.

L'orchestrateur charge exclusivement:
projects/{projectId}/workflowEngine/engine.json

Interdictions:
- Toute alternative du type "charger l'état depuis un document workflow" est interdite.
- Le Workflow Engine n'est jamais reconstruit à partir d'un document workflow.

Validation structurelle obligatoire:
- initialState présent,
- states[] présent et non vide,
- transitions[] présent (vide autorisé uniquement si le schéma le permet),
- currentState, si présent, correspond à un state.id existant.

Si le Workflow Engine est structurellement invalide:
- erreur structurelle,
- aucun contexte n'est livré à Overseer.

6.5 Chargement du contexte étendu
L'orchestrateur peut charger des éléments complémentaires strictement nécessaires:
- logs sous projects/{projectId}/logs/ (lecture uniquement),
- snapshots sous projects/{projectId}/snapshots/ (lecture uniquement),
- paramètres système nécessaires à la préparation d'instructions (lecture uniquement).

Règle:
Tout ajout au contexte étendu doit être explicite dans la structure du contexte, jamais implicite.

6.6 Assemblage du contexte
L'orchestrateur assemble un objet de contexte structuré contenant au minimum:
{
  "project": { ... },
  "documents": { ... },
  "workflowEngine": { ... },
  "logs": { ... },
  "snapshots": { ... }
}

Contraintes:
- workflowEngine est chargé depuis projects/{projectId}/workflowEngine/engine.json et contient l'état courant,
- le contexte est destiné à Overseer et aux agents via Overseer, il n'est jamais une réponse utilisateur,
- aucun champ n'est ajouté si sa sémantique n'est pas définie explicitement dans ce document ou dans un schéma applicable.

6.7 Intervention de ContextAgent
L'intervention de ContextAgent est optionnelle et ne peut être déclenchée que par Overseer.

Jamais déclenché par l’orchestrateur.
Aucune persistance de la synthèse, seule une journalisation de l’appel est autorisée (métadonnées uniquement).

Si Overseer déclenche ContextAgent:
- l'entrée de ContextAgent est une extraction contrôlée du contexte,
- la sortie est une synthèse structurée,
- la sortie ne remplace jamais le contexte source, elle l'accompagne.

ContextAgent ne doit jamais qualifier une incohérence comme acceptable ou bloquante. Seuls Overseer et SuperiorValidationAgent portent ces décisions, selon leurs rôles.

6.8 Retour à Overseer
L'orchestrateur renvoie:
- status,
- projectId,
- contextQuality,
- context complet (et warnings éventuels).

Overseer décide ensuite:
- d'appeler ou non un agent producteur,
- d'appeler ou non SuperiorValidationAgent,
- de poursuivre, corriger, ou abort.

7. Contraintes strictes

7.1 Interdiction d'appel d'agent sans contexte
Overseer ne doit jamais appeler un AgentProducteur si status != "contextLoaded".

7.2 Rechargement obligatoire
Le contexte doit être rechargé pour chaque nouvelle opération agentique. Une réutilisation implicite est interdite.

7.3 Interdiction de cache durable
Aucune mise en cache durable du contexte n'est autorisée. Toute optimisation éventuelle doit rester strictement interne, non observable, et ne doit jamais produire une divergence entre le projet actif et le contexte.

7.4 Invalidation sur changement de projet
Toute modification de currentProject invalide immédiatement tout contexte précédemment chargé. Overseer doit exiger un rechargement complet.

7.5 Interdiction d'inférence d'état depuis un document workflow
Il est interdit de reconstruire, inférer, ou corriger currentState à partir d’un document workflow.

8. Invariants

Toujours vrais:
- Aucun agent ne peut être appelé sans un contexte chargé par l'orchestrateur.
- L'orchestrateur effectue les lectures Firestore, Overseer ne les effectue pas dans ce process.
- ContextAgent ne lit pas Firestore et ne valide pas sémantiquement.
- Toute incohérence structurelle pendant le chargement provoque un arrêt immédiat.
- Le contexte livré est strictement rattaché à un projectId unique et explicite.
- Le contexte n'est jamais exposé tel quel à l'utilisateur.
- projects/{projectId}/workflowEngine/engine.json est l'unique source de vérité pour l'état courant et les transitions.

---
Fin du document
---

Document Metadata & Changelog

Changelog:
  - 1.0.0 (2025-12-20) : Initialisation de la version de référence du document.

Breaking Changes:
  - Aucun (baseline pré-système)
