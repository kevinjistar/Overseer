
---
Document: Process_du_Workflow_Engine
Version: 2.0.0
Date: 2025-12-11
PolicyType: WorkflowProcess

PolicyVersions:
  WorkflowPolicy: 1.0.0
  ValidationPolicy: 1.0.0
  VersioningPolicy: 1.0.0
  CorrectionPolicy: 1.0.0

Changelog:
  - 2.0.0 (2025-12-11): Refonte complète pour alignement avec Workflow Engine v2, Overseer_spec v2, SuperiorValidationAgent, ValidationPolicy_Global et CorrectionMode_Policy.
  - 1.0.0 (2025-12-10): Version initiale.

Breaking Changes:
  - Suppression des conditions dynamiques dans le Workflow Engine.
  - L’orchestrateur n'évalue plus aucune logique métier.
  - Toute transition doit être validée explicitement par Overseer avant exécution.
---

1. Objet du document

Ce document décrit le processus opérationnel complet de gestion des transitions du Workflow Engine dans Overseer v2.

Il définit:
• le rôle d’Overseer,  
• le rôle de l’orchestrateur,  
• les interactions avec SuperiorValidationAgent,  
• les règles de sécurité,  
• la manière dont les transitions structurelles sont appliquées,  
• le comportement en mode correction.

Le Workflow Engine v2 n’est plus un moteur décisionnel.  
Il est une **matrice d’états structurelle** appliquée uniquement sur ordre d’Overseer.


2. Principes fondamentaux

2.1 Aucune logique métier dans le Workflow Engine  
Les transitions ne portent plus aucune condition ou règle métier.  
Toute logique est externe et assurée par Overseer + SuperiorValidationAgent.

2.2 L’orchestrateur applique mécaniquement  
Il vérifie uniquement:
• que la transition existe,  
• que l’état courant correspond au champ from,  
• que les actions sont structurellement valides.

2.3 Overseer est le moteur métier  
Il décide:
• si une transition est pertinente pour le projet,  
• si elle respecte WorkflowPolicy,  
• si une validation globale est nécessaire,  
• si elle peut être exécutée.

2.4 Pas de transition automatique  
Aucune transition ne peut être déclenchée par:
• un agent,
• une modification documentaire,
• un événement structurel,
• un comportement interne du workflow.

Seul Overseer peut ordonner une transition.


3. Pré-requis à toute transition

Avant de déclencher une transition workflow, Overseer doit:

3.1 Vérifier la conformité métier  
• cohérence de l’intention,  
• respect du parcours métier,  
• compatibilité avec WorkflowPolicy.

3.2 Vérifier le document ou l’action déclenchante  
• validation structurelle (orchestrateur),  
• validation locale sémantique (SuperiorValidationAgent),  
• validation globale si requise par WorkflowPolicy ou ValidationPolicy_Global.

3.3 Vérifier l’état système  
• absence de correctionMode,  
• absence d’état halted,  
• cohérence globale du projet.

Aucune transition ne peut être initiée si correctionMode = true.


4. Déclenchement d’une transition (ordre Overseer)

Lorsque les conditions métier sont validées, Overseer produit un ordre formel:

{
  "type": "runWorkflowTransition",
  "projectId": "...",
  "operationId": "...",
  "transitionId": "string",
  "policies": {
    "workflow": "1.0.0",
    "validation": "1.0.0"
  }
}

Cet ordre est envoyé à l’orchestrateur.


5. Rôle de l’orchestrateur pendant une transition

À réception de l’ordre:

5.1 Vérifications structurelles
L’orchestrateur vérifie:
• transitionId existe dans le Workflow Engine,  
• état courant = transitions.from,  
• état cible valide,  
• actions structurelles valides.

5.2 Application structurelle
L’orchestrateur:
• change l’état du workflow,  
• exécute les actions structurelles,  
• produit un snapshot si nécessaire,  
• loggue l'événement avec operationId.

5.3 Aucune logique métier
L’orchestrateur ne:
• valide aucune condition métier,  
• corrige aucune incohérence métier,  
• interprète aucune conséquence système.

En cas d’erreur structurelle:
• transition refusée,  
• erreur renvoyée à Overseer,  
• état projet inchangé.


6. Interaction avec SuperiorValidationAgent

SuperiorValidationAgent n’intervient **pas** dans l’exécution des transitions.

Il intervient **avant**, lorsque Overseer doit décider:
• si la transition est permise métier-ment,
• si elle risque de créer des contradictions globales,
• si elle est cohérente avec les documents racine.

Selon WorkflowPolicy:
• certaines transitions exigent une validation globale préalable.


7. Gestion du mode correction

Lorsque correctionMode = true:
• aucune transition workflow n’est permise,  
• toute demande de transition par Overseer doit être ignorée par l’orchestrateur,  
• les actions structurelles dans Workflow Engine doivent être réduites (log uniquement).

Une transition ne peut être appliquée qu’après:
• validation locale allow,  
• validation globale allow ou warn,  
• sortie du mode correction.


8. Complétion de la transition

Après exécution par l’orchestrateur:

8.1 Overseer reçoit:
• état final,  
• actions exécutées,  
• snapshotId,  
• logs,  
• éventuelle erreur structurelle.

8.2 Overseer:
• valide cohérence métier globale,  
• détecte les risques (SuperiorValidationAgent si nécessaire),  
• décide si une nouvelle action, transition ou mise à jour est pertinente.

Aucune boucle automatique n’est permise.


9. Anti-dérive des transitions

Les règles suivantes sont appliquées:

9.1 Anti-boucle structurelle  
L’orchestrateur limite:
• nombre de transitions par minute,  
• transitions répétitives identiques,
• transitions non déclarées.

9.2 Anti-boucle métier  
Overseer surveille:
• transitions sans progression,  
• transitions contradictoires,  
• oscillations d’états (A→B→A).

En cas de suspicion:
• activation correctionMode,  
• demande de validation globale.

9.3 Detection avant activation  
Le Workflow Engine doit être validé (analyse statique des cycles) avant utilisation.


10. Invariants du Processus Workflow Engine v2

Le système doit toujours garantir:

• aucune transition décidée ou évaluée côté orchestrateur,  
• aucune transition déclenchée automatiquement,  
• aucune condition métier dans le schéma workflow,  
• toutes les transitions ordonnées par Overseer,  
• validation sémantique préalable selon Policy,  
• impossibilité de transition en mode correction,  
• logs + snapshot systématiques lorsque configurés,  
• respect strict de WorkflowPolicy.

Fin du document.
