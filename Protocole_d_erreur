
---
Document: Protocole_d_erreur
Version: 2.0.0
Date: 2025-12-11
PolicyType: ErrorProtocol

PolicyVersions:
  ValidationPolicy: 1.0.0
  WorkflowPolicy: 1.0.0
  CorrectionPolicy: 1.0.0
  System_Agent_Edit_Policy: 1.0.0

Changelog:
  - 2.0.0 (2025-12-11): Refonte complète alignée avec Overseer v2, SuperiorValidationAgent, Workflow Engine v2, CorrectionMode_Policy et la séparation structurel/métier.
  - 1.0.0 (2025-12-10): Version initiale.

Breaking Changes:
  - Clarification stricte entre erreurs structurelles (orchestrateur) et erreurs métier (Overseer + SuperiorValidationAgent).
  - Introduction d’un protocole séquencé entre warning, correctionMode et halted.
  - Suppression de toute réparation automatique côté orchestrateur.
---

1. Objet du document

Ce protocole définit la manière dont les erreurs sont:
• détectées,  
• classifiées,  
• transmises,  
• traitées,  
• et résolues  

dans le système Overseer v2.

L’objectif est d’assurer:
• une réaction déterministe,  
• la préservation de la cohérence,  
• la traçabilité complète,  
• l’absence de réparations non supervisées.

Aucune entité ne partage les responsabilités d’une autre:
• orchestrateur → structurel  
• Overseer → métier  
• SuperiorValidationAgent → sémantique  
• agents → aucun rôle dans l’erreur  


2. Typologie des erreurs

Les erreurs sont classées en trois catégories:
- warning  
- error  
- halted  

Aucune autre classification n’est autorisée.


3. Erreurs structurelles (orchestrateur)

Les erreurs structurelles sont détectées exclusivement par l’orchestrateur, dans les cas suivants:
• JSON invalide ou illisible,  
• non-conformité au schéma universel ou specialized,  
• meta incohérentes,  
• séquence de version invalide,  
• transition workflow impossible (structurellement),  
• quota structurel dépassé,  
• projet ou document introuvable,  
• tentative d’écriture en mode halted,  
• violation des règles de CorrectionMode_Policy (ex: tentative de transition).

3.1 Réaction  
L’opération est immédiatement stoppée.  
Aucune tentative de correction n’est effectuée.  
L’orchestrateur renvoie un message structuré:

{
  "status": "error",
  "errorType": "StructuralError",
  "operationId": "...",
  "projectId": "...",
  "details": "..."
}

3.2 Rôle d’Overseer  
Overseer reçoit l’erreur structurelle et décide:
• retry (rare),  
• correctionMode (si impact métier),  
• abort,  
• ou éventuellement systemRecovery (si les données sont corrompues).

SuperiorValidationAgent n’intervient pas dans les erreurs structurelles.


4. Erreurs sémantiques (SuperiorValidationAgent)

Les erreurs sémantiques apparaissent lorsque:
• le contenu est incohérent sur le plan métier,  
• des contradictions sont détectées,  
• la stabilité documentaire n’est plus assurée,  
• workflowImpact = major,  
• risque global = high,  
• la cohérence stratégique ou architecturale est menacée.

Elles correspondent aux verdicts:

- warn  
- block  

4.1 warn  
Contenu sémantiquement valide mais présentant un risque métier.

4.2 block  
Contenu inacceptable au regard des règles métier et des Policies.

Le verdict renvoyé est de la forme:

{
  "verdict": "warn | block",
  "reasons": [...],
  "riskLevel": "low | medium | high",
  "workflowImpact": "none | minor | major",
  "impactedDocuments": [...],
  "recommendedFixes": [...]
}


5. Erreurs métier (Overseer)

Une erreur métier survient lorsque:
• Overseer détecte une incohérence conceptuelle,  
• un enchaînement illogique d’opérations,  
• une boucle métier,  
• une incohérence globale même après validation structurelle,  
• une condition métier indispensable à une transition n’est pas satisfaite,  
• une mise à jour n’est pas compatible avec WorkflowPolicy.

Les erreurs métier ne sont pas détectées par l’orchestrateur.

5.1 Réaction  
Overseer active le mode correction:

• operationMode = "correction"  
• un seul agent correctif autorisé  
• aucune transition workflow  
• validation globale obligatoire avant sortie  


6. Classification opérationnelle

6.1 warning  
Un problème existe mais n’empêche pas la progression.  
La mise à jour peut être appliquée si Overseer l’accepte.

6.2 error  
Une opération ne peut pas être poursuivie:
• soit pour raison structurelle,  
• soit pour raison sémantique block,  
• soit par décision explicite d’Overseer.

6.3 halted  
État critique empêchant tout fonctionnement normal:
• corruption documentaire,  
• transitions structurelles invalides répétées,  
• échec de correctionMode,  
• blocage métier insurmontable,  
• violation grave des Policies.

Seule systemRecovery peut lever halted.


7. Protocole de traitement des erreurs

7.1 warning  
1. Overseer analyse reasons et riskLevel.  
2. Overseer décide: apply ou correction.  
3. Si apply → log obligatoire.  
4. Si correction → mode correction activé.

7.2 error structurelle (orchestrateur)  
1. opération stoppée,  
2. erreur renvoyée,  
3. Overseer décide:  
   - correctionMode,  
   - abort,  
   - recovery (rare).

7.3 error sémantique block (SuperiorValidationAgent)  
1. Overseer passe automatiquement en correctionMode  
2. Transmission à un agent correctif  
3. Double validation (locale + globale) obligatoire  
4. Sortie du mode correction seulement après stabilisation.

7.4 halted  
1. toutes les opérations cessent,  
2. seules systemRecovery et validateRecovery sont autorisées,  
3. Overseer attend la restauration,  
4. une fois restauré → correctionMode,  
5. validation globale obligatoire.


8. systemRecovery et erreurs

Le passage en halted implique:
• impossibilité d’appliquer des modifications supplémentaires,  
• risque fort de corruption,  
• nécessité d’une restauration.

Le protocole recovery est:
1. Orchestrateur restaure depuis snapshot  
2. Orchestrateur met correctionMode = true  
3. Overseer exécute une validation globale  
4. Overseer autorise ou non la reprise des opérations


9. Journalisation des erreurs

Toute erreur est loggée dans:
logs/{projectId}/errors

Chaque entrée contient:
• timestamp  
• operationId  
• projectId  
• errorType  
• severity  
• actor: orchestrator | overseer | superiorValidationAgent  
• details  
• stateBefore  
• stateAfter  
• policiesActives  


10. Invariants du protocole d’erreur

Toujours vrais:

• L’orchestrateur ne raisonne jamais sur le métier.  
• SuperiorValidationAgent ne modifie jamais Firestore.  
• Overseer est souverain pour les erreurs métier.  
• Aucune réparation automatique côté orchestrateur.  
• Une erreur structurelle arrête immédiatement l’opération en cours.  
• Une erreur sémantique block déclenche correctionMode.  
• halted ne peut être levé que par systemRecovery.  
• Aucun workflow ne peut se déclencher en présence d’une erreur métier ou structurelle.  
• correctionMode est l’unique voie de stabilisation avant halted métier.  

Fin du document.
