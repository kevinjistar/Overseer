
---
Version: 1.0.1
Date: 2025-12-10
Changelog:
  - 1.0.1 (2025-12-10): Mise à jour pour alignement avec le système GAS et la logique locale des phases. Clarification des points d’entrée et suppression des ambiguïtés d’exécution distante.
  - 1.0.0 (2025-12-10): Création de la Structure Cloud Functions / Orchestrateur
Breaking Changes: Aucun depuis 1.0.0

Règle de versioning:
  • Major (X.0.0): Changement structurel des fonctions ou de l’architecture d’orchestration
  • Minor (1.X.0): Ajout de fonctions non disruptives ou élargissement de comportements
  • Patch (1.2.X): Ajustements rédactionnels ou améliorations mineures
---

# Structure Cloud Functions / Orchestrateur

L’orchestrateur est la couche d’exécution de la gouvernance Overseer.  
Il applique les règles système, valide les documents, gère le versioning, exécute les transitions de workflow, maintient les snapshots et relaie les instructions d’Overseer de manière déterministe.

Il ne prend jamais d’initiative autonome.  
Il ne fait jamais d’appel réseau spontané.  
Il ne réalise rien sans instruction explicite d’Overseer.

---

# 1. Points d’entrée Cloud Functions

Sous /functions/, l’orchestrateur expose les points d’entrée suivants:

createProject  
updateDocument  
runWorkflowTransition  
setCurrentProject  
createSnapshot  
validateDocument  
agentCallback  
systemRecovery  

Chaque point d’entrée correspond à un rôle strict dans le système, sans chevauchement.

---

# 2. createProject

Déclenchement:  
- Instruction explicite d’Overseer lors de la création d’un projet.

Fonctions:
- créer l’arborescence documentaire du projet (côté logique orchestrateur)
- initialiser les documents référents (versions 1.0.0)
- initialiser le Workflow Engine associé
- créer le snapshot initial
- enregistrer un log de création
- renvoyer un rapport de création à Overseer

---

# 3. updateDocument

Déclenchement:  
- Requête d’Overseer pour appliquer une mise à jour issue d’un agent ou d’une transition.

Fonctions:
- appeler validateDocument  
- appliquer la règle de versioning  
- mettre à jour meta.updatedAt et meta.ownerAgent  
- ajouter l’entrée correcte dans le changelog  
- préparer l’écriture du document (l’écriture réelle dépendra de l’environnement Firebase au moment du déploiement)
- créer un snapshot cohérent  
- écrire un log d’update  

---

# 4. runWorkflowTransition

Déclenchement:  
- Instruction d’Overseer  
- Ou besoin issu d’une mise à jour documentaire conforme aux règles du Workflow Engine

Fonctions:
- lire la définition du Workflow Engine du projet  
- vérifier les conditions de transition  
- appliquer la transition si validée  
- exécuter les actions associées  
- mettre à jour l’état du workflow  
- logguer la transition

---

# 5. setCurrentProject

Déclenchement:  
- Instruction explicite d’Overseer lors d’un changement de projet en cours.

Fonctions:
- valider l’existence du projectId  
- mettre à jour le contexte utilisateur (currentProject)  
- écrire un log d’état  
- renvoyer la confirmation à Overseer  

---

# 6. createSnapshot

Déclenchement:  
- Création d’un projet  
- Mise à jour documentaire  
- Transition de workflow  
- Demande d’Overseer

Fonctions:
- capturer l’état global actuel du projet  
- stocker un snapshot horodaté  
- enregistrer le motif et l’agent responsable  

---

# 7. validateDocument

Déclenchement:  
- Interne à updateDocument  
- Interne à createSnapshot  
- Ou demande explicite d’Overseer

Fonctions:
- valider conformité au Schéma universel du Document Référent  
- valider conformité au module spécialisé (architecture, UX, stratégie, workflow, notes)  
- vérifier cohérence interne  
- vérifier cohérence inter-document si nécessaire  
- vérifier versioning  
- vérifier liens et références  
- renvoyer un statut: valid ou error  

---

# 8. agentCallback

Déclenchement:  
- Réception d’une réponse d’un agent externe (via Overseer, jamais directement).

Fonctions:
- réceptionner le payload JSON  
- vérifier l’identité logique de l’agent externe  
- transmettre la demande à updateDocument ou runWorkflowTransition  
- journaliser l’activité  
- renvoyer à Overseer un rapport de traitement  

---

# 9. systemRecovery

Déclenchement:  
- Détection d’une erreur critique  
- Détection d’une boucle potentielle  
- Incohérence structurelle  
- Instruction explicite d’Overseer

Fonctions:
- suspendre l’exécution en cours  
- restaurer le dernier snapshot stable  
- produire un log d’erreur  
- renvoyer un rapport à Overseer  

---

# 10. Règles transversales de l’orchestrateur

L’orchestrateur doit toujours:
- effectuer une validation stricte avant toute modification  
- refuser les actions hors currentProject  
- empêcher toute boucle opérationnelle  
- journaliser chaque étape significative  
- garantir des snapshots continus et cohérents  
- appliquer les règles du Workflow Engine sans exception  
- rester strictement déterministe (aucune interprétation libre)  

---

# 11. Interactions Overseer ↔ Orchestrateur

Overseer:
- décide, contextualise, sélectionne les agents, supervise la cohérence, gouverne la version du système.

Orchestrateur:
- exécute, valide, applique, enregistre, stabilise.

Flux standard:

1. Overseer → orchestrateur: instruction (validate, update, transition, snapshot)  
2. Orchestrateur → Firestore (ou couche future): écriture + snapshot  
3. Orchestrateur → Overseer: rapport structuré  

Aucune action n’est exécutée sans instruction préalable d’Overseer.

---

Fin du document Structure Cloud Functions / Orchestrateur.
